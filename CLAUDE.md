# 業務報告作成アプリ開発記録

## プロジェクト概要

Microsoft Teams用の業務報告アプリとして開始したが、複雑さを避けるため standalone Web アプリとして開発。
日々の業務実績と予定を入力し、マークダウン形式でTeamsにコピー&ペーストできる形式で出力する。

## 技術スタック

- **フロントエンド**: Vanilla HTML/CSS/JavaScript
- **データ保存**: localStorage
- **対応ブラウザ**: Chrome推奨
- **デザイン**: レスポンシブデザイン、ダークモード対応

## 主要機能

### 1. 基本機能
- 実績・予定の入力（顧客・プロジェクト別）
- タスク項目と詳細の入力
- マークダウンプレビュー機能
- クリップボードへのコピー&自動保存
- 過去レポートの管理

### 2. 入力支援機能
- オートコンプリート（顧客名・タスク名）
- 選択時刻ベースの表示順（使用頻度順・選択時刻順）
- キーボードナビゲーション（矢印キー、Ctrl+N/P、Enter、Escape）
- 選択時の時刻更新（次回表示順に反映）

### 3. 項目管理機能
- **プロジェクト操作**:
  - 追加・削除
  - 実績⇔予定間の移動
  - 上下並べ替え
- **タスク操作**:
  - 追加・削除
  - 実績⇔予定間の移動
  - 同一プロジェクト内での上下並べ替え

### 4. データ管理機能
- **操作の分離化**:
  - コピー：マークダウンのクリップボードコピー
  - 保存：レポートのlocalStorage保存
  - 次の日へ：予定を実績に複写・日付更新
- **エクスポート・インポート**:
  - エクスポート（JSON設定、全Markdownレポート）
  - インポート（JSON設定、個別Markdownレポート）
  - Markdownファイルの双方向サポート
- **過去レポート管理**:
  - 読み込み・個別ダウンロード・削除
  - 階層構造を維持したMarkdown解析

### 5. UI/UX機能
- ダークモード切り替え
- GitHubリンク（ヘッダー右上）
- レスポンシブデザイン（768px以下対応）
- モーダル設定エディタ
- 現在日時表示
- ページ全体スクロール防止（個別パネルのみスクロール）
- **セッション復元機能**: ページ再読み込み時の入力状態自動復元

## 開発フェーズ

### フェーズ1: 基本UI構築
- HTML構造の作成
- CSS基本スタイリング
- 左右分割レイアウト（6:4比率）

### フェーズ2: 入力機能実装
- 顧客・プロジェクト入力
- タスク入力（メイン・詳細）
- 動的な項目追加

### フェーズ3: オートコンプリート
- 使用履歴に基づく候補表示
- キーボードナビゲーション
- 使用統計の記録

### フェーズ4: マークダウン生成
- リアルタイムプレビュー
- 階層構造での出力
- 日付フォーマット

### フェーズ5: データ管理
- localStorage保存
- 過去レポート管理
- エクスポート/インポート

### フェーズ6: 高度な操作機能
- 項目の移動（実績⇔予定）
- 項目・タスクの削除
- 並べ替え機能

### フェーズ7: UI改善
- ダークモード実装
- コントロールボタン整理
- disabled状態の実装

## アーキテクチャ

### ファイル構成
```
/
├── index.html          # メインHTML
├── styles.css          # スタイルシート
├── script.js           # メインJavaScript
├── CLAUDE.md           # 開発記録
└── README.md           # 操作方法
```

### JavaScript設計
- **BusinessReportApp クラス**: メインアプリケーション
- **イベント委譲**: 動的要素のイベント処理
- **データ構造**:
  ```javascript
  {
    customers: [{name, useCount, lastUsed}],
    tasks: [{text, useCount, lastUsed}],
    reports: [{id, resultDate, planDate, results, plans, markdown, created}]
  }
  ```

### CSS設計
- **CSS Custom Properties**: テーマ管理
- **Flexbox**: レスポンシブレイアウト
- **絶対位置指定**: コントロールボタン配置

## 主要技術課題と解決策

### 1. イベントリスナー重複問題
**問題**: 動的要素追加時の重複イベント登録
**解決**: イベント委譲パターンの採用

### 2. オートコンプリート実装
**問題**: キーボードナビゲーションとマウス操作の両立
**解決**: selectedIndex管理とイベント統合

### 3. データ永続化
**問題**: ブラウザリロード時のデータ保持
**解決**: localStorage + JSON シリアライゼーション

### 4. レイアウト統一
**問題**: プロジェクト・タスクコントロールの表示幅不統一
**解決**: 絶対位置指定による統一配置

### 5. 状態管理
**問題**: 並べ替えボタンの有効/無効状態
**解決**: updateSortButtonStates()による一元管理

## 出力フォーマット

```markdown
- YYYY/MM/DD実績
    - 顧客・プロジェクト名
        - 実施項目(詳細)
        - 実施項目

- YYYY/MM/DD以降の予定
    - 顧客・プロジェクト名
        - 予定項目(詳細)
        - 予定項目
```

## 最新の改修内容（2025年9月10日）

### 1. ボタン機能の分離化
- 「コピー & 保存」ボタンを3つに分割：
  - **コピー**: マークダウンをクリップボードにコピー
  - **保存**: レポートをlocalStorageに保存
  - **次の日へ**: 予定を実績に複写・日付更新

### 2. GitHubリンク追加
- ヘッダー右上にGitHubリンクボタンを追加（🐈‍⬛アイコン）
- 新しいタブでリポジトリを開く機能

### 3. ページスクロール制御
- ページ全体のスクロールを無効化
- 左右パネル内での個別スクロールのみ有効

### 4. オートコンプリート改善
- 表示順を「選択時刻」ベースに変更
- 候補選択時に選択時刻を更新
- 次回表示時に最新の選択順で表示

### 5. レスポンシブデザイン最適化
- 768px以下でのコントロールボタン配置改善
- オートコンプリートドロップダウンの位置調整
- モバイル表示でのスペーシング最適化

### 6. Markdownインポート・エクスポート機能
- **Markdownインポート**:
  - インデントレベル（0:日付、4:プロジェクト、8:タスク）を考慮した階層解析
  - プロジェクト・タスクの関連性を維持
  - メイン項目と詳細（括弧内）の自動分離
- **過去レポートダウンロード**:
  - 個別レポートのMarkdownファイルダウンロード
  - ファイル名形式：`業務報告-YYYY-MM-DD.md`
  - 読み込み・ダウンロード・削除の3つの操作をサポート

### 7. セッション管理機能
- **自動セッション保存**:
  - 日付変更時、入力フィールドのblur時、レポート保存時に自動実行
  - 現在の入力状態（日付、実績、予定）をlocalStorageに保存
- **セッション復元**:
  - ページ初期化時に前回のセッションデータを自動読み込み
  - `restoreSessionData()`でUI状態を完全復元
- **セッション管理**:
  - 「クリア」実行時にセッションデータを削除
  - エラーハンドリングによる安全な復元処理

## 今後の改善案

1. **エクスポート形式の拡張**: PDF、Excel対応
2. **テンプレート機能**: よく使う項目の登録
3. **時間記録**: 工数管理機能
4. **カテゴリ分類**: プロジェクト種別管理
5. **検索機能**: 過去レポートの全文検索
6. **バックアップ機能**: クラウド同期
7. **統計機能**: 月次レポート生成

## 開発メモ

- Teams統合は将来の拡張として保留
- セキュリティ: 機密情報のローカル保存のみ
- パフォーマンス: 大量データでの動作検証が必要
- ブラウザ対応: IE非対応、モダンブラウザ前提
- リポジトリ: https://github.com/ytx/b_report